---
mapped_pages:
  - https://www.elastic.co/guide/en/security/current/machine-learning.html
  - https://www.elastic.co/guide/en/serverless/current/security-machine-learning.html
applies_to:
  stack: all
  serverless:
    security: all
products:
  - id: security
  - id: cloud-serverless
---

# Anomaly detection


::::{note}
[{{ml-cap}}](/explore-analyze/machine-learning/anomaly-detection.md) functionality is available when you have the appropriate role, subscription, are using a [cloud deployment](https://cloud.elastic.co/registration?page=docs&placement=docs-body), or are testing out a **Free Trial**. Refer to [Machine learning job and rule requirements](/solutions/security/advanced-entity-analytics/machine-learning-job-rule-requirements.md) for more information.
::::

Anomaly detection jobs identify anomalous events or patterns in your data. In a security context, they’re typically used with detection rules to trigger alerts when behavior deviates from baseline activity.


::::{tip}
Refer to [{{ml-cap}}: Anomaly detection](/explore-analyze/machine-learning/anomaly-detection.md) and [About detection rules](/solutions/security/detect-and-alert/about-detection-rules.md) for more background.
::::


## Manage {{ml}} jobs [manage-jobs]

If you have the appropriate role, you can use the **ML job settings** interface on the **Alerts**, **Rules**, and **Rule Exceptions** pages to view, start, and stop {{elastic-sec}} {{ml}} jobs.

:::{image} /solutions/images/security-ml-ui.png
:alt: ML job settings UI on the Alerts page
:screenshot:
:::


### Manage {{ml}} detection rules [manage-ml-rules]

You can also check the status of {{ml}} detection rules, and start or stop their associated {{ml}} jobs:

* On the **Rules** page, the **Last response** column displays the rule’s current [status](/solutions/security/detect-and-alert/manage-detection-rules.md#rule-status). An indicator icon (![Error icon from rules table](/solutions/images/security-rules-table-error-icon.png "title =20x20")) also appears if a required {{ml}} job isn’t running. Click the icon to list the affected jobs, then click **Visit rule details page to investigate** to open the rule’s details page.

    :::{image} /solutions/images/security-rules-table-ml-job-error.png
    :alt: Rules table {{ml}} job error
    :screenshot:
    :::

* On a rule’s details page, check the **Definition** section to confirm whether the required {{ml}} jobs are running. Switch the toggles on or off to run or stop each job.

    :::{image} /solutions/images/security-rules-ts-ml-job-stopped.png
    :alt: Rule details page with ML job stopped
    :screenshot:
    :::

::::{tip}
* For instructions on creating {{ml}} rules, refer to [Create a machine learning rule](/solutions/security/detect-and-alert/create-detection-rule.md#create-ml-rule).
* Alerts generated by {{ml}} rules are displayed on the **Alerts** page. For more information, refer to [Manage detection alerts](/solutions/security/detect-and-alert/manage-detection-alerts.md).
::::


### Prebuilt jobs [included-jobs]

{{elastic-sec}} comes with prebuilt {{ml}} {{anomaly-jobs}} for automatically detecting host and network anomalies. The jobs are displayed in the `Anomaly Detection` interface. They are available when either:

* You ship data using [Beats](https://www.elastic.co/products/beats) or the [{{agent}}](/solutions/security/configure-elastic-defend/install-elastic-defend.md), and {{kib}} is configured with the required index patterns (such as `auditbeat-*`, `filebeat-*`, `packetbeat-*`, or `winlogbeat-*`) on the **Data Views** page. To find this page, navigate to **Data Views** in the navigation menu or by using the [global search field](/explore-analyze/find-and-organize/find-apps-and-objects.md).

Or

* Your shipped data is ECS-compliant, and {{kib}} is configured with the shipped data’s index patterns on the **Data Views** page.

Or

* You install one or more of the [Advanced Analytics integrations](/solutions/security/advanced-entity-analytics/behavioral-detection-use-cases.md#ml-integrations).

[](/reference/data-analysis/machine-learning/ootb-ml-jobs-siem.md) describes all available {{ml}} jobs and lists their requirements. For information on tuning anomaly results to reduce the number of false positives, see [Optimizing anomaly results](/solutions/security/advanced-entity-analytics/optimizing-anomaly-results.md).

::::{note}
Machine learning jobs look back and analyze two weeks of historical data prior to the time they are enabled. After jobs are enabled, they continuously analyze incoming data. When jobs are stopped and restarted within the two-week time frame, previously analyzed data is not processed again.
::::


## View detected anomalies [view-anomalies]

View details of detected anomalies in the **Anomalies** data tables, available on the **Hosts**, **Network**, or **Users** pages. You can access these pages from the navigation menu or with the [global search field](/explore-analyze/find-and-organize/find-apps-and-objects.md).

::::{note}
To view the **Anomalies** table  and **Max Anomaly Score By Job** details, the user must have the `machine_learning_admin` or `machine_learning_user` role.
::::

:::{image} /solutions/images/security-host-anomalies.png
:alt: Host anomalies
:screenshot:
:::

::::{note}
To adjust the `score` threshold that determines which anomalies are shown, you can modify the `securitySolution:defaultAnomalyScore` [advanced setting](/solutions/security/get-started/configure-advanced-settings.md).
::::

In the **Anomalies** table, you can add entity details, like the entity or any associated influencers, into Timeline.

:::{image} /solutions/images/security-host-anomaly-add-to-timeline.png
:alt: Host anomalies
:screenshot:
:::

When you click into a specific host, IP, or user name (depending on the page), you can narrow the time range to a specific anomaly. To do this, click the info icon next to a maximum anomaly score and select **Narrow to this date range**.

:::{image} /solutions/images/security-host-max-anomaly-score-by-job.png
:alt: Filter by Max anomaly score by job
:screenshot:
:::

On this page, you can also add fields to Timeline by hovering over a field name and selecting the Add to timeline icon.

:::{image} /solutions/images/security-host-add-to-timeline.png
:alt: Filter by Max anomaly score by job
:screenshot:
:::
